<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcritor Inteligente | Labor AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #0d9488;
            --primary-hover: #0f766e;
            --background-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #d1d5db;
            --success-color: #16a34a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 700px;
            text-align: center;
            padding: 40px;
        }

        .header { margin-bottom: 32px; }
        .header h1 { font-size: 32px; font-weight: 700; }
        .header p { font-size: 18px; color: var(--text-secondary); margin-top: 8px; }

        #drop-area { border: 2px dashed var(--border-color); border-radius: 12px; padding: 48px; cursor: pointer; transition: all 0.2s ease; }
        #drop-area:hover, #drop-area.dragover { border-color: var(--primary-color); background-color: #f0fdfa; }

        #file-name { margin-top: 16px; font-weight: 500; color: var(--primary-color); }

        .task-options { margin-top: 24px; text-align: left; }
        .task-option { padding: 16px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 12px; cursor: pointer; display: flex; align-items: center; }
        .task-option input[type="radio"] { margin-right: 12px; }
        .task-option.selected { border-color: var(--primary-color); background-color: #f0fdfa; }
        
        #email-section { margin-top: 16px; display: none; text-align: left; }
        #email-section label { display: block; margin-bottom: 8px; font-weight: 500; }
        #email-input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; }

        #submit-button { width: 100%; padding: 16px; margin-top: 24px; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; }
        #submit-button:disabled { background-color: #a5b0b8; cursor: not-allowed; }

        #processing-stage .spinner { width: 48px; height: 48px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #status-text { margin-top: 24px; font-weight: 500; color: var(--text-secondary); }

        #result-stage { text-align: left; }
        #result-text { width: 100%; height: 350px; padding: 16px; border: 1px solid var(--border-color); border-radius: 8px; font-family: 'Fira Code', monospace; line-height: 1.7; resize: vertical; }
        .result-actions { margin-top: 16px; display: flex; gap: 16px; }

        #confirmation-section { text-align: center; padding: 40px; background-color: #f0fdfa; border-radius: 12px; }

        .button { flex-grow: 1; padding: 12px; font-size: 15px; font-weight: 500; border-radius: 8px; border: none; cursor: pointer; }
        .btn-copy { background-color: var(--success-color); color: white; }
        .btn-reset { background-color: var(--text-secondary); color: white; }

        .footer { margin-top: 40px; font-size: 14px; color: var(--text-secondary); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>Transcritor Inteligente</h1>
            <p>Envie seu áudio e deixe a IA da Labor AI fazer o trabalho pesado.</p>
        </header>

        <!-- ETAPA 1: UPLOAD E CONFIGURAÇÃO -->
        <div id="upload-stage">
            <input type="file" id="file-input" class="hidden" accept="audio/*">
            <div id="drop-area">
                <p>Arraste e solte seu áudio aqui ou clique para selecionar</p>
                <small>Formatos: MP3, M4A, OGG, WAV, etc.</small>
            </div>
            <p id="file-name" class="hidden"></p>

            <div id="task-options" class="task-options hidden">
                <h4>1. Escolha a ação:</h4>
                <div class="task-option" data-task="transcribe">
                    <input type="radio" name="task" value="transcribe" id="task_simple">
                    <label for="task_simple">Apenas Transcrever</label>
                </div>
                <div class="task-option" data-task="summary">
                    <input type="radio" name="task" value="summary" id="task_summary">
                    <label for="task_summary">Gerar Resumo por IA (Enviado por E-mail)</label>
                </div>
            </div>

            <div id="email-section" class="hidden">
                <h4>2. Informe seu e-mail para receber o resumo:</h4>
                <input type="email" id="email-input" placeholder="seu@email.com">
            </div>

            <button id="submit-button" disabled>Selecione um arquivo</button>
        </div>

        <!-- ETAPA 2: PROCESSANDO -->
        <div id="processing-stage" class="hidden">
            <div class="spinner"></div>
            <p id="status-text">Processando...</p>
        </div>

        <!-- ETAPA 3: RESULTADOS -->
        <div id="result-stage" class="hidden">
            <h3>Transcrição Completa</h3>
            <textarea id="result-text" readonly></textarea>
            <div class="result-actions">
                <button id="copy-button" class="button btn-copy">Copiar Texto</button>
                <button id="reset-button" class="button btn-reset">Processar Outro</button>
            </div>
        </div>

        <div id="confirmation-section" class="hidden">
            <h3>Sucesso!</h3>
            <p>Seu pedido foi recebido. O resumo será gerado e enviado para o e-mail informado em breve.</p>
            <button id="reset-button-2" class="button btn-reset" style="margin-top: 20px;">Processar Outro</button>
        </div>

    </div>

    <footer class="footer">
        Desenvolvido pela Labor AI
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const webhookUrl = 'https://n8n-n8n.znxk1t.easypanel.host/webhook/a7afa173-d939-46f8-80d7-0e2a9845c928';

            // Seletores
            const uploadStage = document.getElementById('upload-stage');
            const processingStage = document.getElementById('processing-stage');
            const resultStage = document.getElementById('result-stage');
            const confirmationSection = document.getElementById('confirmation-section');
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const fileNameDisplay = document.getElementById('file-name');
            const taskOptions = document.getElementById('task-options');
            const emailSection = document.getElementById('email-section');
            const submitButton = document.getElementById('submit-button');
            const statusText = document.getElementById('status-text');
            const resultText = document.getElementById('result-text');
            const copyButton = document.getElementById('copy-button');
            const resetButton = document.getElementById('reset-button');
            const resetButton2 = document.getElementById('reset-button-2');

            let selectedFile = null;
            let selectedTask = '';

            // Lógica de Upload
            dropArea.addEventListener('click', () => fileInput.click());
            dropArea.addEventListener('dragover', (e) => { e.preventDefault(); dropArea.classList.add('dragover'); });
            dropArea.addEventListener('dragleave', () => dropArea.classList.remove('dragover'));
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
            });
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length) handleFile(fileInput.files[0]);
            });

            function handleFile(file) {
                selectedFile = file;
                fileNameDisplay.textContent = `Arquivo selecionado: ${file.name}`;
                fileNameDisplay.classList.remove('hidden');
                taskOptions.classList.remove('hidden');
                validateForm();
            }

            // Lógica de Seleção de Tarefa
            document.querySelectorAll('.task-option').forEach(option => {
                option.addEventListener('click', () => {
                    selectedTask = option.dataset.task;
                    document.querySelectorAll('.task-option').forEach(el => el.classList.remove('selected'));
                    option.classList.add('selected');
                    option.querySelector('input[type="radio"]').checked = true;
                    emailSection.classList.toggle('hidden', selectedTask !== 'summary');
                    validateForm();
                });
            });

            document.getElementById('email-input').addEventListener('input', validateForm);
            
            function validateForm() {
                const isTaskSelected = selectedTask !== '';
                const isEmailValid = selectedTask !== 'summary' || (document.getElementById('email-input').value.includes('@'));
                const canProcess = selectedFile && isTaskSelected && isEmailValid;
                
                submitButton.disabled = !canProcess;
                if (!selectedFile) submitButton.textContent = 'Selecione um arquivo';
                else if (!isTaskSelected) submitButton.textContent = 'Escolha uma ação';
                else if (!isEmailValid) submitButton.textContent = 'Informe um e-mail válido';
                else submitButton.textContent = 'Transcrever Áudio';
            }
            
            // Lógica de Envio e Processamento
            submitButton.addEventListener('click', async () => {
                if (!selectedFile) return;
                uploadStage.classList.add('hidden');
                processingStage.classList.remove('hidden');
                statusText.textContent = 'Enviando arquivo para o servidor...';

                const formData = new FormData();
                formData.append('audio', selectedFile);
                formData.append('task', selectedTask);
                if (selectedTask === 'summary') {
                    formData.append('userEmail', document.getElementById('email-input').value);
                }

                try {
                    const response = await fetch(webhookUrl, { method: 'POST', body: formData });
                    statusText.textContent = 'Aguardando a IA processar o áudio...';
                    if (!response.ok) throw new Error(`Erro do servidor: ${response.status}`);
                    
                    if (selectedTask === 'transcribe') {
                        const result = await response.json();
                        if (result && result.transcricao) {
                            resultText.value = result.transcricao;
                            processingStage.classList.add('hidden');
                            resultStage.classList.remove('hidden');
                        } else {
                           throw new Error('Resposta do servidor inválida.');
                        }
                    } else { // Tarefa de resumo
                        processingStage.classList.add('hidden');
                        confirmationSection.classList.remove('hidden');
                    }
                } catch (error) {
                    processingStage.classList.add('hidden');
                    uploadStage.classList.remove('hidden');
                    alert(`Ocorreu um erro: ${error.message}`);
                    resetUI();
                }
            });
            
            // Ações Finais
            copyButton.addEventListener('click', () => {
                navigator.clipboard.writeText(resultText.value);
                copyButton.textContent = 'Copiado!';
                setTimeout(() => { copyButton.textContent = 'Copiar Texto'; }, 2000);
            });
            
            const resetUI = () => {
                selectedFile = null;
                selectedTask = '';
                fileInput.value = '';
                document.getElementById('email-input').value = '';
                fileNameDisplay.classList.add('hidden');
                taskOptions.classList.add('hidden');
                emailSection.classList.add('hidden');
                document.querySelectorAll('.task-option').forEach(el => el.classList.remove('selected'));
                document.querySelectorAll('input[name="task"]').forEach(radio => radio.checked = false);
                resultStage.classList.add('hidden');
                confirmationSection.classList.add('hidden');
                uploadStage.classList.remove('hidden');
                validateForm();
            };

            resetButton.addEventListener('click', resetUI);
            resetButton2.addEventListener('click', resetUI);
        });
    </script>
</body>
</html>
